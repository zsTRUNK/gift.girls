<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>girls. | –†—É–ª–µ—Ç–∫–∞</title>
    <link rel="stylesheet" href="css/style.css?v=3">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/mobile-enhancements.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap"
        rel="stylesheet">
</head>

<body>
    <header></header>

    <main style="padding-top: 150px; padding-bottom: 80px;">
        <section class="container">
            <div style="max-width: 900px; margin: 0 auto; text-align: center;">

                <h1 class="hero-title" style="font-size: 56px; margin-bottom: 10px;">–†—É–ª–µ—Ç–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h1>
                <p class="hero-subtitle" style="margin: 0 auto 50px; border-left: none; padding-left: 0;">
                    –ò—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É! –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏ —É–∑–Ω–∞–π, –∫—Ç–æ –≤—ã–∏–≥—Ä–∞–µ—Ç
                </p>

                <!-- Roulette Container -->
                <div class="roulette-container glass">

                    <!-- Animation Warning Overlay -->
                    <div id="rouletteWarningOverlay" class="chat-warning-overlay" style="border-radius: 24px;">
                        <div class="chat-warning-content">
                            <!-- Warning Icon -->
                            <div class="warning-triangle">
                                <svg viewBox="0 0 100 100" class="triangle-svg">
                                    <polygon points="50,10 90,85 10,85" fill="url(#triangleGradient)" />
                                    <defs>
                                        <linearGradient id="triangleGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#ff4444;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#cc0000;stop-opacity:1" />
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <span class="exclamation-mark">!</span>
                            </div>

                            <!-- Warning Message -->
                            <h2 class="warning-title">–ê–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã</h2>
                            <p class="warning-message">–†—É–ª–µ—Ç–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏.<br>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞,
                                –≤–∫–ª—é—á–∏—Ç–µ –∏—Ö.</p>

                            <!-- Inline Animation Toggle -->
                            <div class="warning-toggle-wrapper">
                                <span class="warning-toggle-label">–ê–Ω–∏–º–∞—Ü–∏–∏</span>
                                <label class="warning-switch">
                                    <input type="checkbox" id="rouletteAnimToggle">
                                    <span class="warning-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Info Modal -->
                    <div id="infoModal" class="info-modal-overlay">
                        <div class="info-modal-content glass">
                            <button id="closeInfoBtn" class="close-info-btn">√ó</button>
                            <h2 class="info-title">–û –†—É–ª–µ—Ç–∫–µ</h2>
                            <div class="info-description">
                                <p style="margin-bottom: 15px; font-weight: 600;">–†—É–ª–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞, —á—Ç–æ–±—ã —Ä–∞–¥–æ–≤–∞—Ç—å
                                    —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤! ‚ú®</p>

                                <h4 style="color: white; margin-bottom: 8px; font-family: 'Montserrat', sans-serif;">–í
                                    —á–µ–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è —Å—É—Ç—å —Ä—É–ª–µ—Ç–∫–∏?</h4>
                                <p style="margin-bottom: 15px;">–í—ã –∫—Ä—É—Ç–∏—Ç–µ –±–∞—Ä–∞–±–∞–Ω, –≤–∞–º –≤—ã–ø–∞–¥–∞–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫ –∏ –µ–≥–æ –ø—Ä–∏–∑.
                                    –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ, –µ—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∞—Ä–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–∏–∑ –µ–º—É.</p>

                                <div
                                    style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 10px; border-left: 3px solid #0088cc; text-align: left;">
                                    <p style="margin: 0; font-size: 13px;">–ï—Å–ª–∏ –≤–∞–º –≤—ã–ø–∞–ª <span
                                            style="color: #0088cc; font-weight: 700;">TON</span>, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∞—Ä–∏—Ç—å –µ–≥–æ
                                        –ª–∏–±–æ –≤ –≤–∏–¥–µ NFT, –ª–∏–±–æ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –∫–æ—à–µ–ª—ë–∫.</p>
                                </div>
                            </div>

                            <h3 class="info-subtitle">–ü—Ä–∏–∑—ã –∏ —à–∞–Ω—Å—ã</h3>
                            <div class="prizes-list" id="prizesList">
                                <!-- Prizes will be injected here via JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Roulette Display -->
                    <div class="roulette-display">
                        <!-- Selection Indicator (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞) -->
                        <div class="roulette-indicator"></div>

                        <!-- Scrolling Items Container -->
                        <div class="roulette-wheel" id="rouletteWheel">
                            <!-- Items –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>

                    <!-- Spin Button with Hint -->
                    <div style="text-align: center; margin-bottom: 30px; position: relative; z-index: 10;">
                        <div class="spin-hint"
                            style="font-family: 'Montserrat', sans-serif; font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-bottom: 10px; opacity: 0; transition: opacity 0.3s;"
                            id="spinHint">
                            –ù–∞–∂–º–∏ 2 —Ä–∞–∑–∞ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                        </div>
                        <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                            <button class="btn btn-primary roulette-spin-btn" id="spinBtn">
                                <span class="btn-text"
                                    style="font-family: 'Montserrat', sans-serif; font-weight: 700; letter-spacing: 2px;">–ö–†–£–¢–ò–¢–¨
                                    –†–£–õ–ï–¢–ö–£</span>
                            </button>
                            <button id="infoBtn" class="info-btn-inline" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">i</button>
                        </div>
                    </div>

                    <!-- Winner Display (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏) -->
                    <div class="winner-display" id="winnerDisplay" style="background: rgba(30, 30, 46, 0.98);">
                        <div class="winner-content">
                            <h3 class="winner-title">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</h3>
                            <div class="winner-card">
                                <img id="winnerImg" src="" alt="Winner" class="winner-avatar">
                                <div class="winner-name" id="winnerName"></div>
                            </div>
                            <div class="winner-buttons">
                                <button class="btn btn-outline" id="closeWinnerBtn">–ù–∞–∑–∞–¥ –∫ —Ä—É–ª–µ—Ç–∫–µ</button>
                                <button class="btn btn-primary" id="spinAgainBtn">–ö—Ä—É—Ç–∏—Ç—å –µ—â—ë —Ä–∞–∑</button>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Info Panel -->
                <div class="roulette-info glass" style="margin-top: 30px; padding: 25px;">
                    <h3 style="margin-bottom: 15px; color: white;">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h3>
                    <div style="font-size: 48px; font-weight: 800; font-family: 'Playfair Display', serif;"
                        id="participantCount">0</div>
                </div>

            </div>
        </section>
    </main>

    <footer></footer>

    <script src="js/main.js"></script>
    <script>
        injectComponents('roulette');

        document.addEventListener('DOMContentLoaded', () => {
            // Full Participant List
            const participants = [
                { id: 'ikronez', name: 'ikronez', img: 'img/participants/ikronez.png' },
                { id: 'anora', name: 'anora', img: 'img/participants/anora.png' },
                { id: 'shamuratov', name: 'shamuratov', img: 'img/participants/shamuratov.png' },
                { id: 'vetements', name: 'vetements', img: 'img/participants/vetements.png' },
                { id: 'matvey', name: '–ú–∞—Ç–≤–µ–π', img: 'img/participants/matvey.jpg' },
                { id: 'laysik', name: 'Laysik', img: 'img/participants/laysik.png' },
                { id: 'tony', name: 'Tony Barelly', img: 'img/participants/tony.png' },
                { id: 'ikar', name: 'íÜú…®. ”Ñ. «ü.  Ä. íÜú', img: 'img/participants/ikar.png' },
                { id: 'ma', name: 'M|A', img: 'img/participants/ma.png' },
                { id: 'histon', name: '—Ö–∏—Å—Ç–æ–Ω', img: 'img/participants/histon.jpg' },
                { id: 'discomfort', name: 'discomfort', img: 'img/participants/discomfort.png' },
                { id: 's', name: 'S', img: 'img/participants/s.png' },
                { id: 'imash', name: '–∏–º–∞—à', img: 'img/participants/imash.png' },
                { id: 'varya', name: '–≤–∞—Ä—è', img: 'img/participants/varya.png' },
                { id: 'robert', name: '–†–æ–±–µ—Ä—Ç –§–∏—Ä', img: 'img/participants/robert.jpg' },
                { id: 'seldex', name: 'seldex', img: 'img/participants/seldex.png' },
                { id: 'simpatia', name: 'simpat√≠a ausente', img: 'img/participants/simpatia.png' },
                { id: '2d', name: '2D', img: 'img/participants/melanmolly.png' },
                { id: 'evelka', name: 'Evelkka', img: 'img/participants/evelka.png' },
                { id: 'sonya', name: 'sonechka', img: 'img/participants/sonya.png' },
                { id: 'yulkk', name: 'yulkk', img: 'img/participants/yulkk.png' },
                { id: 'hoshiko', name: 'hoshiko', img: 'img/participants/hoshiko.png' },
                { id: 'ksuukras', name: 'ksuukras', img: 'img/participants/ksuukras.jpg' },
                { id: 'uainni', name: 'uainni', img: 'img/participants/uainni.png' },
                { id: 'unlucky', name: 'unlucky', img: 'img/participants/unlucky.png' },
                { id: 'lina', name: 'lina', img: 'img/participants/lina.png' },
                { id: 'valeriia', name: 'Valeriia', img: 'img/participants/valeriia.png' },
                { id: 'nastyusha', name: '–Ω–∞—Å—Ç—é—à–∞', img: 'img/participants/nastyusha.png' },
                { id: 'ansty', name: 'ansty', img: 'img/participants/ansty.png' },
                { id: 'stepashha', name: 'stepashha', img: 'img/participants/stepashha.png' },
                { id: 'chrwcn', name: 'chrwcn', img: 'img/participants/chrwcn.jpg' },
                { id: 'dana', name: 'Dana', img: 'img/participants/dana.png' },
                { id: 'waiting', name: 'waiting', img: 'img/participants/waiting.png' },
                { id: 'sarra', name: 'sarra', img: 'img/participants/sarra.png' },
                { id: 'sophie', name: 'sophie', img: 'img/participants/sophie.png' },
                { id: 'lerochka', name: '–õ–µ—Ä–æ—á–∫–∞', img: 'img/participants/lerochka.png' },
                { id: 'nagaserena', name: 'NagaSerena', img: 'img/participants/nagaserena.png' },
                { id: 'ellenachka', name: 'Ellenachka', img: 'img/participants/ellenachka.png' },
                { id: 'madiii', name: 'ùê¶ùêöùêùùê¢ùê¢ùê¢', img: 'img/participants/madiii.png' },
                { id: 'minn', name: 'Minni', img: 'img/participants/minn.png' },
                { id: 'latency', name: 'latency', img: 'img/participants/latency.png' },
                { id: 'ronin', name: ' Ä·¥è…¥…™…¥', img: 'img/participants/ronin.png' },
                { id: 'anastasia', name: '–ê–Ω–∞—Å—Ç–∞—Å–∏—è –õ–∏—Ç–≤–∏–Ω', img: 'img/participants/anastasia.jpg' },
                { id: 'mua', name: 'mua', img: 'img/participants/mua.png' },
                { id: 'marlboro', name: 'marlboro', img: 'img/participants/marlboro.png' },
                { id: 'hostyan', name: '—Ö–æ—Å—Ç—è–Ω', img: 'img/participants/hostyan.png' },
                { id: 'armen', name: '–ê—Ä–º–µ–Ω', img: 'img/participants/armen.png' },
                { id: 'velya', name: '–≤–µ–ª—è', img: 'img/participants/velya.png' },
                { id: 'spilwy', name: 'spilwy', img: 'img/participants/spilwy.jpg' },
                { id: 'max_cursed', name: '–º–∞–∫—Å –∫—É—Ä—Å–µ–¥', img: 'img/participants/max_cursed.png' },
                { id: 'pivnouy', name: 'pivnouy', img: 'img/participants/pivnouy.png' }
            ];

            // ========================================
            // Prize Data & Logic
            // ========================================

            const prizes = [
                // –ú–∞—Å—Å–æ–≤—ã–µ –ø–æ–¥–∞—Ä–∫–∏
                { id: 'heart', name: '–°–µ—Ä–¥—Ü–µ', cost: '15‚≠ê', percent: 20 },
                { id: 'bear', name: '–ú–∏—à–∫–∞', cost: '15‚≠ê', percent: 18 },
                { id: 'gift', name: '–ü–æ–¥–∞—Ä–æ–∫', cost: '25‚≠ê', percent: 14 },
                { id: 'rose', name: '–†–æ–∑–∞', cost: '25‚≠ê', percent: 12 },
                { id: 'cake', name: '–¢–æ—Ä—Ç', cost: '50‚≠ê', percent: 8 },
                { id: 'bouquet', name: '–ë—É–∫–µ—Ç', cost: '50‚≠ê', percent: 6 },
                { id: 'rocket', name: '–†–∞–∫–µ—Ç–∞', cost: '50‚≠ê', percent: 5 },
                { id: 'champagne', name: '–®–∞–º–ø–∞–Ω—Å–∫–æ–µ', cost: '50‚≠ê', percent: 4 },

                // –î–æ—Ä–æ–≥–∏–µ –ø–æ–¥–∞—Ä–∫–∏
                { id: 'cup', name: '–ö—É–±–æ–∫', cost: '100‚≠ê', percent: 2.5 },
                { id: 'ring', name: '–ö–æ–ª—å—Ü–æ', cost: '100‚≠ê', percent: 2 },
                { id: 'diamond', name: '–ê–ª–º–∞–∑', cost: '100‚≠ê', percent: 1.5 },

                // Telegram Premium
                { id: 'premium_3', name: 'Premium 3 –º–µ—Å—è—Ü–∞', cost: '1000‚≠ê', percent: 0.9 },
                { id: 'premium_6', name: 'Premium 6 –º–µ—Å—è—Ü–µ–≤', cost: '1500‚≠ê', percent: 0.6 },
                { id: 'premium_12', name: 'Premium 12 –º–µ—Å—è—Ü–µ–≤', cost: '2000‚≠ê', percent: 0.4 },

                // NFT (TON)
                { id: 'ton_5', name: '5 TON', cost: 'TON', percent: 0.7 },
                { id: 'ton_10', name: '10 TON', cost: 'TON', percent: 0.6 },
                { id: 'ton_15', name: '15 TON', cost: 'TON', percent: 0.5 },
                { id: 'ton_20', name: '20 TON', cost: 'TON', percent: 0.4 },
                { id: 'ton_25', name: '25 TON', cost: 'TON', percent: 0.35 },
                { id: 'ton_30', name: '30 TON', cost: 'TON', percent: 0.3 },
                { id: 'ton_35', name: '35 TON', cost: 'TON', percent: 0.25 },
                { id: 'ton_40', name: '40 TON', cost: 'TON', percent: 0.22 },
                { id: 'ton_45', name: '45 TON', cost: 'TON', percent: 0.20 },
                { id: 'ton_50', name: '50 TON', cost: 'TON', percent: 0.18 },
                { id: 'ton_55', name: '55 TON', cost: 'TON', percent: 0.16 },
                { id: 'ton_60', name: '60 TON', cost: 'TON', percent: 0.14 },
                { id: 'ton_65', name: '65 TON', cost: 'TON', percent: 0.12 },
                { id: 'ton_70', name: '70 TON', cost: 'TON', percent: 0.11 },
                { id: 'ton_75', name: '75 TON', cost: 'TON', percent: 0.10 },
                { id: 'ton_80', name: '80 TON', cost: 'TON', percent: 0.09 },
                { id: 'ton_85', name: '85 TON', cost: 'TON', percent: 0.08 },
                { id: 'ton_90', name: '90 TON', cost: 'TON', percent: 0.07 },
                { id: 'ton_95', name: '95 TON', cost: 'TON', percent: 0.06 },
                { id: 'ton_100', name: '100 TON', cost: 'TON', percent: 0.05 }
            ];

            // Weighted Random Selection
            function getRandomPrize() {
                const totalWeight = prizes.reduce((sum, prize) => sum + prize.percent, 0);
                let random = Math.random() * totalWeight;

                for (const prize of prizes) {
                    if (random < prize.percent) {
                        return prize;
                    }
                    random -= prize.percent;
                }

                return prizes[0]; // Fallback
            }

            // DOM Elements
            const wheel = document.getElementById('rouletteWheel');
            const spinBtn = document.getElementById('spinBtn');
            const spinAgainBtn = document.getElementById('spinAgainBtn');
            const closeWinnerBtn = document.getElementById('closeWinnerBtn');
            const winnerDisplay = document.getElementById('winnerDisplay');
            const participantCountEl = document.getElementById('participantCount');

            // State
            let isSpinning = false;
            let currentTranslate = 0;

            // Update participant count
            participantCountEl.textContent = participants.length;

            // Create roulette items (–º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –¥–ª—è –±–µ—Å—à–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞)
            function createRouletteItems() {
                wheel.innerHTML = '';

                // –°–æ–∑–¥–∞–µ–º items –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑ –¥–ª—è –¥–ª–∏–Ω–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 20, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –Ω–µ –≤—ã–ª–µ—Ç–µ—Ç—å –≤ –ø—É—Å—Ç–æ—Ç—É –ø—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏–∏
                const repetitions = 20;

                for (let r = 0; r < repetitions; r++) {
                    participants.forEach(participant => {
                        const item = document.createElement('div');
                        item.className = 'roulette-item';
                        item.innerHTML = `
                            <img src="${participant.img}" alt="${participant.name}" class="roulette-avatar">
                            <span class="roulette-name">${participant.name}</span>
                        `;
                        wheel.appendChild(item);
                    });
                }
            }

            // Sound Manager (Web Audio API)
            const soundManager = {
                ctx: null,
                init() {
                    if (!this.ctx) {
                        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    }
                },
                playTick() {
                    if (!this.ctx) return;
                    if (this.ctx.state === 'suspended') this.ctx.resume();

                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();

                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–≤—É–∫–∞ "—Ç–∏–∫–∞" (–∫–æ—Ä–æ—Ç–∫–∏–π, –≤—ã—Å–æ–∫–∏–π —â–µ–ª—á–æ–∫)
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(800, this.ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(1200, this.ctx.currentTime + 0.05);

                    gain.gain.setValueAtTime(0.3, this.ctx.currentTime); // –ì—Ä–æ–º–∫–æ—Å—Ç—å
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.05);

                    osc.connect(gain);
                    gain.connect(this.ctx.destination);

                    osc.start();
                    osc.stop(this.ctx.currentTime + 0.1);
                },
                playWin() {
                    if (!this.ctx) return;
                    if (this.ctx.state === 'suspended') this.ctx.resume();

                    // –ü—Ä–æ—Å—Ç–æ–π –º–∞–∂–æ—Ä–Ω—ã–π –∞–∫–∫–æ—Ä–¥ –¥–ª—è –ø–æ–±–µ–¥—ã
                    const notes = [523.25, 659.25, 783.99, 1046.50]; // C E G C
                    notes.forEach((freq, i) => {
                        const osc = this.ctx.createOscillator();
                        const gain = this.ctx.createGain();

                        osc.type = 'sine';
                        osc.frequency.value = freq;

                        gain.gain.setValueAtTime(0.1, this.ctx.currentTime + i * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + i * 0.1 + 0.5);

                        osc.connect(gain);
                        gain.connect(this.ctx.destination);

                        osc.start(this.ctx.currentTime + i * 0.1);
                        osc.stop(this.ctx.currentTime + i * 0.1 + 0.6);
                    });
                }
            };

            // Easing function: cubic-bezier(0.25, 1, 0.5, 1) - –±—ã—Å—Ç—Ä–æ–µ –Ω–∞—á–∞–ª–æ, –æ—á–µ–Ω—å –ø–ª–∞–≤–Ω—ã–π –∫–æ–Ω–µ—Ü
            function easeOutCubic(t) {
                return 1 - Math.pow(1 - t, 3);
            }

            // Spin the roulette
            let animationFrameId = null;
            let currentWinner = null;
            let currentPrize = null;

            function spin() {
                // –ï—Å–ª–∏ —É–∂–µ –∫—Ä—É—Ç–∏—Ç—Å—è –∏ –Ω–∞–∂–∞–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                if (isSpinning) {
                    skipAnimation();
                    return;
                }

                if (spinBtn.disabled && !isSpinning) return;

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞
                soundManager.init();

                isSpinning = true;
                // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–ª–Ω–æ—Å—Ç—å—é, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–∂–∞—Ç—å —Å–∫–∏–ø
                // –ù–æ –º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Ç–∏–ª—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º –∫–ª–∏–∫.
                // spinBtn.disabled = true; 

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                document.getElementById('spinHint').style.opacity = '1';

                winnerDisplay.classList.remove('active');

                // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å
                const winnerIndex = Math.floor(Math.random() * participants.length);
                const winner = participants[winnerIndex];

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∫–∏–ø–∞
                currentWinner = winner;

                // Dynamic heights for mobile/desktop support
                const rect = wheel.getBoundingClientRect();
                const firstItem = wheel.firstElementChild;
                const itemHeight = firstItem ? firstItem.offsetHeight : (window.innerWidth <= 768 ? 100 : 120);
                const displayHeight = document.querySelector('.roulette-display').offsetHeight;

                const centerOffset = (displayHeight / 2) - (itemHeight / 2);
                const middleRepetition = 10;
                const extraSpins = participants.length * 5;

                // Target position
                const targetIndex = middleRepetition * participants.length + winnerIndex;
                const startPosition = 0;
                const finalPosition = (targetIndex + extraSpins) * itemHeight - centerOffset;
                const totalDistance = finalPosition - startPosition;

                // Prize
                const prize = getRandomPrize();
                currentPrize = prize;

                // Animation
                const duration = 5000;
                let startTime = null;

                function step(timestamp) {
                    if (!isSpinning) return;

                    if (!startTime) startTime = timestamp;
                    const elapsed = timestamp - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    const easedProgress = easeOutCubic(progress);
                    const currentPosition = startPosition + (totalDistance * easedProgress);

                    wheel.style.transform = `translateY(-${currentPosition}px)`;

                    if (progress < 1) {
                        animationFrameId = requestAnimationFrame(step);
                    } else {
                        finishSpin();
                    }
                }

                wheel.style.transition = 'none';
                animationFrameId = requestAnimationFrame(step);
            }

            function skipAnimation() {
                if (animationFrameId) cancelAnimationFrame(animationFrameId);
                finishSpin();
            }

            function finishSpin() {
                isSpinning = false;
                document.getElementById('spinHint').style.opacity = '0';

                // Recalculate based on current state to ensure perfect alignment
                const firstItem = wheel.firstElementChild;
                const itemHeight = firstItem ? firstItem.offsetHeight : (window.innerWidth <= 768 ? 100 : 120);
                const displayHeight = document.querySelector('.roulette-display').offsetHeight;
                const centerOffset = (displayHeight / 2) - (itemHeight / 2);

                let wIndex = 0;
                for (let i = 0; i < participants.length; i++) {
                    if (participants[i].id === currentWinner.id) {
                        wIndex = i;
                        break;
                    }
                }

                const targetRepetition = 10;
                const finalPos = (targetRepetition * participants.length + wIndex) * itemHeight - centerOffset;

                wheel.style.transform = `translateY(-${finalPos}px)`;
                wheel.style.filter = 'none';

                soundManager.playWin();
                showWinner(currentWinner, currentPrize);
            }

            // Show winner
            function showWinner(winner, prize) {
                document.getElementById('winnerImg').src = winner.img;

                // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤—ã–∏–≥—Ä—ã—à–∞
                const participantName = winner.name;
                // –ï—Å–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å TON, –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º –µ—ë –≤ —Å–∫–æ–±–∫–∞—Ö, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ —É–∂–µ –µ—Å—Ç—å –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
                const prizeText = prize.cost === 'TON' ? prize.name : `${prize.name} (${prize.cost})`;

                document.getElementById('winnerName').innerHTML = `<span style="color: var(--color-primary);">${participantName}</span><br>${prizeText}`;

                setTimeout(() => {
                    winnerDisplay.classList.add('active');
                }, 500);
            }

            // Reset roulette
            function reset() {
                winnerDisplay.classList.remove('active');

                // Reset position instantly
                wheel.style.transition = 'none';
                wheel.style.transform = 'translateY(0)';

                // Force reflow
                void wheel.offsetHeight;

                setTimeout(() => {
                    wheel.style.transition = '';
                }, 50);
            }

            // ========================================
            // Animation Warning Overlay Logic
            // ========================================

            const warningOverlay = document.getElementById('rouletteWarningOverlay');
            const rouletteAnimToggle = document.getElementById('rouletteAnimToggle');

            // Check animation settings and show/hide overlay
            function checkAnimationSettings() {
                const savedAnim = localStorage.getItem('site_animations');
                const isAnimEnabled = savedAnim === null ? true : savedAnim === 'true';

                if (!isAnimEnabled) {
                    // Animations are disabled - show warning
                    warningOverlay.classList.add('active');
                    rouletteAnimToggle.checked = false;
                    spinBtn.disabled = true; // Disable spin button
                } else {
                    // Animations are enabled - hide warning
                    warningOverlay.classList.remove('active');
                    rouletteAnimToggle.checked = true;
                    if (!isSpinning) spinBtn.disabled = false; // Enable if not spinning
                }
            }

            // Handle toggle change from warning overlay
            rouletteAnimToggle.addEventListener('change', (e) => {
                const enabled = e.target.checked;

                if (enabled) {
                    // Enable animations
                    document.body.classList.remove('no-animations');
                    localStorage.setItem('site_animations', 'true');

                    // Hide warning overlay
                    setTimeout(() => {
                        warningOverlay.classList.remove('active');
                    }, 100);

                    if (!isSpinning) spinBtn.disabled = false;
                } else {
                    // Disable animations
                    document.body.classList.add('no-animations');
                    localStorage.setItem('site_animations', 'false');
                    warningOverlay.classList.add('active');
                    spinBtn.disabled = true;
                }
            });

            // Check settings on page load
            checkAnimationSettings();

            // Listen for changes in localStorage
            window.addEventListener('storage', (e) => {
                if (e.key === 'site_animations') {
                    checkAnimationSettings();
                }
            });

            // Periodically check (for sync across tabs)
            setInterval(checkAnimationSettings, 500);

            // Event Listeners
            spinBtn.addEventListener('click', spin);

            spinAgainBtn.addEventListener('click', () => {
                reset();
                setTimeout(spin, 100);
            });

            closeWinnerBtn.addEventListener('click', () => {
                winnerDisplay.classList.remove('active');
            });

            // Initialize
            createRouletteItems();

            // ========================================
            // Info Modal Logic
            // ========================================
            const infoBtn = document.getElementById('infoBtn');
            const infoModal = document.getElementById('infoModal');
            const closeInfoBtn = document.getElementById('closeInfoBtn');
            const prizesList = document.getElementById('prizesList');

            // Open Modal
            infoBtn.addEventListener('click', () => {
                infoModal.classList.add('active');
                renderPrizes();
            });

            // Close Modal
            closeInfoBtn.addEventListener('click', () => {
                infoModal.classList.remove('active');
            });

            // Close on outside click
            infoModal.addEventListener('click', (e) => {
                if (e.target === infoModal) {
                    infoModal.classList.remove('active');
                }
            });

            // Render Prizes Dynamically
            function renderPrizes() {
                if (prizesList.children.length > 0) return; // Render once

                // Sort prizes by percent (descending) if needed, but keeping user order is often better for categories.
                // Keeping user order.

                prizes.forEach(prize => {
                    const item = document.createElement('div');
                    item.className = 'prize-item';
                    item.innerHTML = `
                        <span class="prize-name">${prize.name} (${prize.cost})</span>
                        <span class="prize-chance">${prize.percent}%</span>
                    `;
                    prizesList.appendChild(item);
                });
            }
        });
    </script>
</body>

</html>